<?xml version='1.0' encoding='UTF-8'?>
<project>
  <actions/>
  <description></description>
  <keepDependencies>false</keepDependencies>
  <properties>
    <com.coravy.hudson.plugins.github.GithubProjectProperty plugin="github@1.17.1">
      <projectUrl>https://github.com/nfs-ganesha/nfs-ganesha/</projectUrl>
      <displayName></displayName>
    </com.coravy.hudson.plugins.github.GithubProjectProperty>
    <com.chikli.hudson.plugin.naginator.NaginatorOptOutProperty plugin="naginator@1.15">
      <optOut>false</optOut>
    </com.chikli.hudson.plugin.naginator.NaginatorOptOutProperty>
    <hudson.model.ParametersDefinitionProperty>
      <parameterDefinitions>
        <hudson.model.StringParameterDefinition>
          <name>BOOTSTRAP_SCRIPT</name>
          <description>Python script that reserves a machine from Duffy and starts the ${TEST_SCRIPT}.</description>
          <defaultValue>https://raw.githubusercontent.com/nfs-ganesha/ci-tests/centos-ci/build-fsal_gluster/bootstrap.py</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.StringParameterDefinition>
          <name>TEST_SCRIPT</name>
          <description>Test script to execute on the reserved machine, should move to the some NFS-Ganesha upstream testing repo at one point.</description>
          <defaultValue>https://raw.githubusercontent.com/nfs-ganesha/ci-tests/centos-ci/build-fsal_gluster/build-fsal_gluster.sh</defaultValue>
        </hudson.model.StringParameterDefinition>
        <hudson.model.ChoiceParameterDefinition>
          <name>GERRIT_HOST</name>
          <description>Gerrit instance hosting the git repository.</description>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>review.gerrithub.io</string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
        <hudson.model.ChoiceParameterDefinition>
          <name>GERRIT_PROJECT</name>
          <description>Gerrit project of the git repository.</description>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>ffilz/nfs-ganesha</string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
        <hudson.model.ChoiceParameterDefinition>
          <name>GERRIT_REFSPEC</name>
          <description>Patch set from the upstream git repository to build from.</description>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>refs/changes/81/276581/1</string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
        <hudson.model.ChoiceParameterDefinition>
          <name>CENTOS_VERSION</name>
          <description>CentOS version to build the RPMs for.</description>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>7</string>
              <string>6</string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
        <hudson.model.ChoiceParameterDefinition>
          <name>CENTOS_ARCH</name>
          <description>CentOS architecture to build the RPMs for.</description>
          <choices class="java.util.Arrays$ArrayList">
            <a class="string-array">
              <string>x86_64</string>
              <string>i386</string>
            </a>
          </choices>
        </hudson.model.ChoiceParameterDefinition>
      </parameterDefinitions>
    </hudson.model.ParametersDefinitionProperty>
  </properties>
  <scm class="hudson.scm.NullSCM"/>
  <assignedNode>nfs-ganesha</assignedNode>
  <canRoam>false</canRoam>
  <disabled>false</disabled>
  <blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
  <blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
  <triggers>
    <com.sonyericsson.hudson.plugins.gerrit.trigger.hudsontrigger.GerritTrigger plugin="gerrit-trigger@2.17.0">
      <spec></spec>
      <gerritProjects>
        <com.sonyericsson.hudson.plugins.gerrit.trigger.hudsontrigger.data.GerritProject>
          <compareType>PLAIN</compareType>
          <pattern>ffilz/nfs-ganesha</pattern>
          <branches>
            <com.sonyericsson.hudson.plugins.gerrit.trigger.hudsontrigger.data.Branch>
              <compareType>ANT</compareType>
              <pattern>**</pattern>
            </com.sonyericsson.hudson.plugins.gerrit.trigger.hudsontrigger.data.Branch>
          </branches>
          <disableStrictForbiddenFileVerification>false</disableStrictForbiddenFileVerification>
        </com.sonyericsson.hudson.plugins.gerrit.trigger.hudsontrigger.data.GerritProject>
      </gerritProjects>
      <skipVote>
        <onSuccessful>false</onSuccessful>
        <onFailed>false</onFailed>
        <onUnstable>false</onUnstable>
        <onNotBuilt>false</onNotBuilt>
      </skipVote>
      <silentMode>true</silentMode>
      <notificationLevel></notificationLevel>
      <silentStartMode>false</silentStartMode>
      <escapeQuotes>true</escapeQuotes>
      <noNameAndEmailParameters>false</noNameAndEmailParameters>
      <dependencyJobsNames></dependencyJobsNames>
      <readableMessage>false</readableMessage>
      <buildStartMessage></buildStartMessage>
      <buildFailureMessage></buildFailureMessage>
      <buildSuccessfulMessage></buildSuccessfulMessage>
      <buildUnstableMessage></buildUnstableMessage>
      <buildNotBuiltMessage></buildNotBuiltMessage>
      <buildUnsuccessfulFilepath></buildUnsuccessfulFilepath>
      <customUrl></customUrl>
      <serverName>nfs-ganesha-gerrithub</serverName>
      <triggerOnEvents>
        <com.sonyericsson.hudson.plugins.gerrit.trigger.hudsontrigger.events.PluginPatchsetCreatedEvent>
          <excludeDrafts>true</excludeDrafts>
          <excludeTrivialRebase>false</excludeTrivialRebase>
          <excludeNoCodeChange>true</excludeNoCodeChange>
        </com.sonyericsson.hudson.plugins.gerrit.trigger.hudsontrigger.events.PluginPatchsetCreatedEvent>
        <com.sonyericsson.hudson.plugins.gerrit.trigger.hudsontrigger.events.PluginCommentAddedContainsEvent>
          <commentAddedCommentContains>recheck gluster</commentAddedCommentContains>
        </com.sonyericsson.hudson.plugins.gerrit.trigger.hudsontrigger.events.PluginCommentAddedContainsEvent>
      </triggerOnEvents>
      <dynamicTriggerConfiguration>false</dynamicTriggerConfiguration>
      <triggerConfigURL></triggerConfigURL>
      <triggerInformationAction/>
    </com.sonyericsson.hudson.plugins.gerrit.trigger.hudsontrigger.GerritTrigger>
  </triggers>
  <concurrentBuild>false</concurrentBuild>
  <builders>
    <hudson.tasks.Shell>
      <command># no need for verbose output
set +x

# download and run the bootstrap script
curl -o bootstrap.py ${BOOTSTRAP_SCRIPT}
python bootstrap.py
RET=$?

# we accept different return values
# 0 - SUCCESS + VOTE
# 1 - FAILED + VOTE
# 10 - SUCCESS + REPORT ONLY (NO VOTE)
# 11 - FAILED + REPORT ONLY (NO VOTE)

case ${RET} in
0)
	MESSAGE=&quot;${BUILD_URL}/console : SUCCESS&quot;
	VERIFIED=&apos;--verified +1&apos;
	NOTIFY=&apos;--notify ALL&apos;
	;;
1)
	MESSAGE=&quot;${BUILD_URL}/console : FAILED&quot;
	VERIFIED=&apos;--verified -1&apos;
	NOTIFY=&apos;--notify ALL&apos;
	;;
10)
	MESSAGE=&quot;${BUILD_URL}/console : SUCCESS (skipping vote)&quot;
	VERIFIED=&apos;&apos;
	NOTIFY=&apos;--notify NONE&apos;
	;;
11)
	MESSAGE=&quot;${BUILD_URL}/console : FAILED (skipping vote)&quot;
	VERIFIED=&apos;&apos;
	NOTIFY=&apos;--notify NONE&apos;
	;;
*)
	MESSAGE=&quot;${BUILD_URL}/console : unknown return value ${RET}&quot;
	VERIFIED=&apos;&apos;
	NOTIFY=&apos;--notify NONE&apos;
esac

# Update Gerrit with the success/failure status
ssh \
    -l jenkins-glusterorg \
    -i ~/.ssh/gerrithub@gluster.org \
    -o StrictHostKeyChecking=no \
    -p 29418 \
    review.gerrithub.io \
    gerrit review \
        --message &quot;${MESSAGE}&quot; \
        --project ffilz/nfs-ganesha \
        ${VERIFIED} \
        ${NOTIFY} \
        ${GERRIT_PATCHSET_REVISION}

# exit with SUCCESS or FAIL only
[ ${RET} -eq 0 ]</command>
    </hudson.tasks.Shell>
  </builders>
  <publishers/>
  <buildWrappers/>
</project>
